---
- name: Configure Aliyun Online YUM Repo
  hosts: all
  become: yes

  tasks:
    - name: 1. Clean existing repos (自动清理旧配置)
      shell: rm -rf /etc/yum.repos.d/*

    - name: 2. Add Aliyun Rocky 8 Repo
      copy:
        dest: /etc/yum.repos.d/aliyun.repo
        content: |
          [baseos]
          name=Rocky Linux $releasever - BaseOS
          baseurl=https://mirrors.aliyun.com/rockylinux/$releasever/BaseOS/$basearch/os/
          gpgcheck=1
          enabled=1
          gpgkey=https://mirrors.aliyun.com/rockylinux/RPM-GPG-KEY-rockyofficial

          [appstream]
          name=Rocky Linux $releasever - AppStream
          baseurl=https://mirrors.aliyun.com/rockylinux/$releasever/AppStream/$basearch/os/
          gpgcheck=1
          enabled=1
          gpgkey=https://mirrors.aliyun.com/rockylinux/RPM-GPG-KEY-rockyofficial

          [extras]
          name=Rocky Linux $releasever - Extras
          baseurl=https://mirrors.aliyun.com/rockylinux/$releasever/extras/$basearch/os/
          gpgcheck=1
          enabled=1
          gpgkey=https://mirrors.aliyun.com/rockylinux/RPM-GPG-KEY-rockyofficial

    - name: 3. Make Cache
      command: dnf makecache
